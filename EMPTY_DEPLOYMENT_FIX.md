# Cloudflare Pages éƒ¨ç½²æˆåŠŸä½†æ²’æœ‰æ–‡ä»¶è¢«éƒ¨ç½² - å•é¡Œä¿®å¾©æŒ‡å—

## ğŸš¨ å•é¡Œæè¿°

éƒ¨ç½²éç¨‹é¡¯ç¤ºæˆåŠŸï¼Œä½†åœ¨ Cloudflare Dashboard çš„éƒ¨ç½²æ–‡ä»¶åˆ—è¡¨ä¸­**ä¸€å€‹æ–‡ä»¶éƒ½æ²’æœ‰**ï¼Œæˆ–è€…ç¶²ç«™ç„¡æ³•è¨ªå•ã€‚

## ğŸ” å•é¡ŒåŸå› åˆ†æ

### ä¸»è¦åŸå› 

1. **`functions/_worker.js` æ””æˆªæ‰€æœ‰è«‹æ±‚**
   - å¦‚æœå­˜åœ¨ `functions/_worker.js`ï¼ŒCloudflare Pages æœƒä½¿ç”¨å®ƒæ””æˆªæ‰€æœ‰è«‹æ±‚
   - å³ä½¿ worker è©¦åœ–è½‰ç™¼è«‹æ±‚ï¼Œä¹Ÿå¯èƒ½å°è‡´éœæ…‹æ–‡ä»¶ç„¡æ³•æ­£å¸¸æœå‹™
   - **é€™æ˜¯å°è‡´æ–‡ä»¶ç„¡æ³•éƒ¨ç½²çš„æœ€å¸¸è¦‹åŸå› **

2. **Build output directory é…ç½®éŒ¯èª¤**
   - å¦‚æœè¨­ç½®ç‚ºéŒ¯èª¤çš„ç›®éŒ„ï¼ˆå¦‚ `dist`ã€`build`ï¼‰ï¼ŒCloudflare å¯èƒ½æ‰¾ä¸åˆ°æ–‡ä»¶
   - å¿…é ˆè¨­ç½®ç‚º `.`ï¼ˆç•¶å‰ç›®éŒ„ï¼‰

3. **æ–‡ä»¶è¢«å¿½ç•¥æˆ–æœªæäº¤**
   - æª¢æŸ¥ `.gitignore` æ˜¯å¦å¿½ç•¥äº†é‡è¦æ–‡ä»¶
   - ç¢ºä¿æ‰€æœ‰æ–‡ä»¶éƒ½å·²æäº¤åˆ° Git

4. **Cloudflare Pages é…ç½®å•é¡Œ**
   - Build output directory è¨­ç½®éŒ¯èª¤
   - Root directory è¨­ç½®éŒ¯èª¤

## âœ… è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šåˆªé™¤ `functions/_worker.js`ï¼ˆæœ€æ¨è–¦ï¼‰

**å°æ–¼éœæ…‹ç¶²ç«™é …ç›®ï¼Œé€šå¸¸ä¸éœ€è¦ `functions/_worker.js`**

#### ç‚ºä»€éº¼è¦åˆªé™¤ï¼Ÿ

- `functions/_worker.js` æœƒæ””æˆª**æ‰€æœ‰è«‹æ±‚**ï¼ŒåŒ…æ‹¬éœæ…‹æ–‡ä»¶
- å³ä½¿ worker è©¦åœ–è½‰ç™¼è«‹æ±‚ï¼Œä¹Ÿå¯èƒ½å°è‡´å•é¡Œ
- å°æ–¼éœæ…‹ç¶²ç«™ï¼ŒCloudflare Pages æœƒè‡ªå‹•è™•ç†éœæ…‹æ–‡ä»¶æœå‹™
- API Functionsï¼ˆ`functions/api/*.js`ï¼‰åœ¨æ²’æœ‰ `_worker.js` çš„æƒ…æ³ä¸‹ä»ç„¶æ­£å¸¸å·¥ä½œ

#### æ“ä½œæ­¥é©Ÿï¼š

1. **åˆªé™¤ `functions/_worker.js` æ–‡ä»¶**
2. **æäº¤æ›´æ”¹**ï¼š
   ```bash
   git rm functions/_worker.js
   git commit -m "Remove _worker.js to fix static file deployment"
   git push origin main
   ```

3. **ç­‰å¾… Cloudflare è‡ªå‹•é‡æ–°éƒ¨ç½²**

### æ–¹æ¡ˆ 2ï¼šä¿®å¾© `functions/_worker.js`ï¼ˆå¦‚æœéœ€è¦ä¿ç•™ï¼‰

å¦‚æœæ‚¨éœ€è¦ä¿ç•™ workerï¼ˆä¾‹å¦‚ç”¨æ–¼è‡ªå®šç¾©è·¯ç”±ï¼‰ï¼Œéœ€è¦ç¢ºä¿å®ƒä¸æœƒæ””æˆªéœæ…‹æ–‡ä»¶ï¼š

```javascript
export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);
    
    // å°æ–¼ API è«‹æ±‚ï¼Œè®“ Pages Functions è™•ç†
    if (url.pathname.startsWith('/api/')) {
      // Pages Functions æœƒè‡ªå‹•è™•ç†
      return fetch(request);
    }
    
    // å°æ–¼éœæ…‹æ–‡ä»¶ï¼Œä¸æ””æˆªï¼Œè®“ Pages æ­£å¸¸æœå‹™
    // å¯¦éš›ä¸Šï¼Œæˆ‘å€‘æ‡‰è©²ç›´æ¥è¿”å›ï¼Œè®“ Pages è™•ç†
    // ä½†ç”±æ–¼ _worker.js å­˜åœ¨æ™‚æœƒæ””æˆªæ‰€æœ‰è«‹æ±‚ï¼Œæˆ‘å€‘éœ€è¦æ˜ç¢ºè™•ç†
    
    // å°æ–¼æ‰€æœ‰å…¶ä»–è«‹æ±‚ï¼ˆåŒ…æ‹¬éœæ…‹è³‡æºï¼‰ï¼Œç›´æ¥è½‰ç™¼
    // ä½†æ›´å¥½çš„æ–¹å¼æ˜¯ï¼šå¦‚æœä¸éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œå°±åˆªé™¤é€™å€‹æ–‡ä»¶
    return fetch(request);
  }
};
```

**ä½†æœ€ç°¡å–®çš„æ–¹å¼ä»ç„¶æ˜¯åˆªé™¤ `functions/_worker.js`**

### æ–¹æ¡ˆ 3ï¼šæª¢æŸ¥ä¸¦ä¿®æ­£ Cloudflare Dashboard é…ç½®

åœ¨ Cloudflare Dashboard ä¸­ç¢ºèªä»¥ä¸‹é…ç½®ï¼š

```
Framework preset: None
Build command: npm install --force
Build output directory: .  â† å¿…é ˆæ˜¯ç•¶å‰ç›®éŒ„
Root directory: /
Deploy command: echo "Deploying via Cloudflare Pages automatic deployment"
```

**é—œéµæª¢æŸ¥é»**ï¼š
- âœ… **Build output directory** å¿…é ˆæ˜¯ `.`ï¼ˆç•¶å‰ç›®éŒ„ï¼‰
- âœ… **Root directory** å¿…é ˆæ˜¯ `/`ï¼ˆæ ¹ç›®éŒ„ï¼‰
- âœ… ç¢ºä¿æ²’æœ‰è¨­ç½®ç‚º `dist`ã€`build` æˆ–å…¶ä»–ç›®éŒ„

### æ–¹æ¡ˆ 4ï¼šé©—è­‰æ–‡ä»¶çµæ§‹

ç¢ºä¿ä»¥ä¸‹æ–‡ä»¶åœ¨é …ç›®æ ¹ç›®éŒ„ä¸”å·²æäº¤åˆ° Gitï¼š

```
âœ“ index.html
âœ“ src/
âœ“ assets/
âœ“ functions/api/  (API functionsï¼Œä¸éœ€è¦ _worker.js)
```

æª¢æŸ¥ `.gitignore` ç¢ºä¿æ²’æœ‰å¿½ç•¥é‡è¦æ–‡ä»¶ï¼š

```gitignore
# æ‡‰è©²å¿½ç•¥çš„
node_modules/
.DS_Store
*.log
.env
.wrangler/
dist/

# ä¸æ‡‰è©²å¿½ç•¥çš„ï¼ˆå¿…é ˆæäº¤ï¼‰
index.html
src/
assets/
functions/
```

## ğŸ”§ å®Œæ•´ä¿®å¾©æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šåˆªé™¤ `functions/_worker.js`

```bash
# åˆªé™¤æ–‡ä»¶
git rm functions/_worker.js

# æäº¤æ›´æ”¹
git commit -m "Remove _worker.js to fix static file deployment"

# æ¨é€åˆ° GitHub
git push origin main
```

### æ­¥é©Ÿ 2ï¼šç¢ºèª Cloudflare Dashboard é…ç½®

1. ç™»å…¥ [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. é€²å…¥ **Pages** â†’ æ‚¨çš„å°ˆæ¡ˆ â†’ **Settings** â†’ **Builds & deployments**
3. ç¢ºèªä»¥ä¸‹é…ç½®ï¼š
   ```
   Framework preset: None
   Build command: npm install --force
   Build output directory: .
   Root directory: /
   Deploy command: echo "Deploying via Cloudflare Pages automatic deployment"
   ```

### æ­¥é©Ÿ 3ï¼šæ¸…é™¤ç·©å­˜ä¸¦é‡æ–°éƒ¨ç½²

1. åœ¨ Cloudflare Dashboard ä¸­ï¼š
   - Pages â†’ æ‚¨çš„å°ˆæ¡ˆ â†’ Settings â†’ Builds & deployments
   - é»æ“Š **"Clear cache and retry deployment"**

2. æˆ–è€…ç­‰å¾…è‡ªå‹•éƒ¨ç½²ï¼ˆæ¨é€ä»£ç¢¼å¾Œæœƒè‡ªå‹•è§¸ç™¼ï¼‰

### æ­¥é©Ÿ 4ï¼šé©—è­‰éƒ¨ç½²

éƒ¨ç½²å®Œæˆå¾Œï¼Œåœ¨ Cloudflare Dashboard ä¸­ï¼š

1. é€²å…¥ **Pages** â†’ æ‚¨çš„å°ˆæ¡ˆ â†’ **Deployments**
2. é»æ“Šæœ€æ–°çš„éƒ¨ç½²
3. æŸ¥çœ‹ **"Files"** æˆ– **"Assets"** æ¨™ç±¤
4. æ‡‰è©²çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
   - âœ… `index.html`
   - âœ… `src/` ç›®éŒ„
   - âœ… `assets/` ç›®éŒ„
   - âœ… `functions/api/` ç›®éŒ„ï¼ˆAPI functionsï¼‰

5. è¨ªå•æ‚¨çš„ç¶²ç«™ URLï¼Œæ‡‰è©²èƒ½çœ‹åˆ°éŠæˆ²ç•Œé¢

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

ä¿®å¾©å¾Œï¼Œç¢ºèªä»¥ä¸‹é …ç›®ï¼š

- [ ] `functions/_worker.js` å·²åˆªé™¤ï¼ˆæˆ–å·²ä¿®å¾©ï¼‰
- [ ] Build output directory è¨­ç½®ç‚º `.`
- [ ] Root directory è¨­ç½®ç‚º `/`
- [ ] `index.html` åœ¨é …ç›®æ ¹ç›®éŒ„
- [ ] æ‰€æœ‰æ–‡ä»¶éƒ½å·²æäº¤åˆ° Git
- [ ] Cloudflare ç·©å­˜å·²æ¸…é™¤
- [ ] éƒ¨ç½²æ–‡ä»¶åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ–‡ä»¶
- [ ] ç¶²ç«™å¯ä»¥æ­£å¸¸è¨ªå•

## ğŸ¯ ç‚ºä»€éº¼åˆªé™¤ `_worker.js` æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Ÿ

1. **éœæ…‹ç¶²ç«™ä¸éœ€è¦ worker**
   - Cloudflare Pages æœƒè‡ªå‹•è™•ç†éœæ…‹æ–‡ä»¶æœå‹™
   - ä¸éœ€è¦é¡å¤–çš„ worker æ””æˆªè«‹æ±‚

2. **API Functions ä»ç„¶å·¥ä½œ**
   - `functions/api/*.js` æ–‡ä»¶æœƒè‡ªå‹•è¢«è­˜åˆ¥ç‚º API ç«¯é»
   - ä¸éœ€è¦ `_worker.js` ä¾†è™•ç† API è«‹æ±‚

3. **é¿å…è¡çª**
   - `_worker.js` æœƒæ””æˆªæ‰€æœ‰è«‹æ±‚ï¼Œå¯èƒ½èˆ‡éœæ…‹æ–‡ä»¶æœå‹™è¡çª
   - åˆªé™¤å¾Œï¼ŒPages æœƒè‡ªå‹•è™•ç†æ‰€æœ‰è«‹æ±‚é¡å‹

4. **æ›´ç°¡å–®çš„é…ç½®**
   - æ¸›å°‘é…ç½®è¤‡é›œåº¦
   - é™ä½å‡ºéŒ¯å¯èƒ½æ€§

## âš ï¸ ä»€éº¼æ™‚å€™éœ€è¦ `_worker.js`ï¼Ÿ

åªæœ‰åœ¨ä»¥ä¸‹æƒ…æ³ä¸‹æ‰éœ€è¦ `functions/_worker.js`ï¼š

1. **è‡ªå®šç¾©è·¯ç”±è™•ç†**
   - éœ€è¦é‡å¯« URL
   - éœ€è¦è‡ªå®šç¾©é‡å®šå‘è¦å‰‡

2. **è«‹æ±‚ä¿®æ”¹**
   - éœ€è¦ä¿®æ”¹è«‹æ±‚é ­
   - éœ€è¦æ·»åŠ å®‰å…¨ç­–ç•¥

3. **ç‰¹æ®Šé‚è¼¯**
   - éœ€è¦ A/B æ¸¬è©¦
   - éœ€è¦åœ°ç†ä½ç½®è·¯ç”±

**å°æ–¼å¤§å¤šæ•¸éœæ…‹ç¶²ç«™é …ç›®ï¼Œéƒ½ä¸éœ€è¦ `_worker.js`**

## ğŸ” å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨

å¦‚æœåˆªé™¤ `_worker.js` å¾Œå•é¡Œä»ç„¶å­˜åœ¨ï¼š

1. **æª¢æŸ¥éƒ¨ç½²æ—¥èªŒ**ï¼š
   - åœ¨ Cloudflare Dashboard ä¸­æŸ¥çœ‹å®Œæ•´çš„æ§‹å»ºæ—¥èªŒ
   - å°‹æ‰¾éŒ¯èª¤è¨Šæ¯æˆ–è­¦å‘Š

2. **æª¢æŸ¥æ–‡ä»¶åˆ—è¡¨**ï¼š
   - ç¢ºèªéƒ¨ç½²çš„æ–‡ä»¶åˆ—è¡¨ä¸­æ˜¯å¦æœ‰æ–‡ä»¶
   - å¦‚æœæ²’æœ‰ï¼Œæª¢æŸ¥ Build output directory è¨­ç½®

3. **é©—è­‰ Git æäº¤**ï¼š
   - ç¢ºèªæ‰€æœ‰æ–‡ä»¶éƒ½å·²æäº¤åˆ° Git
   - æª¢æŸ¥ `.gitignore` æ˜¯å¦å¿½ç•¥äº†é‡è¦æ–‡ä»¶

4. **è¯ç¹« Cloudflare æ”¯æ´**ï¼š
   - å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½ç„¡æ•ˆï¼Œå¯èƒ½æ˜¯å¹³å°å•é¡Œ
   - æä¾›å®Œæ•´çš„æ§‹å»ºæ—¥èªŒå’Œé…ç½®æˆªåœ–

## ğŸ“ ç¸½çµ

**æœ€ç°¡å–®æœ‰æ•ˆçš„è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. âœ… åˆªé™¤ `functions/_worker.js`
2. âœ… ç¢ºèª Build output directory è¨­ç½®ç‚º `.`
3. âœ… æ¸…é™¤ Cloudflare ç·©å­˜
4. âœ… é‡æ–°éƒ¨ç½²

é€™æ‡‰è©²èƒ½è§£æ±º 99% çš„"éƒ¨ç½²æˆåŠŸä½†æ²’æœ‰æ–‡ä»¶"çš„å•é¡Œã€‚




